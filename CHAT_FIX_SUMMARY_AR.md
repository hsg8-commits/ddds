# ๐ง ููุฎุต ุฅุตูุงุญ ุฃุฎุทุงุก ุงููุญุงุฏุซุงุช ูุน ุงูุฃุทุจุงุก

## ๐ ุงููุดุงูู ุงูุฃุตููุฉ

### 1๏ธโฃ ุฎุทุฃ ูู ุงูุฎุงุฏู (Server Error)
```
Error in createRoom: Error: Room validation failed:
Cast to ObjectId failed for value "" (type string) at path "_id"
because of "BSONError"
```

**ุงูุณุจุจ:**
- ุนูุฏ ูุญุงููุฉ ุฅูุดุงุก ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ ูุน ุทุจูุจุ ูุงู ูุชู ุฅุฑุณุงู `_id: ""` (ูููุฉ ูุงุฑุบุฉ)
- MongoDB ูุฑูุถ ุงูููู ุงููุงุฑุบุฉ ูุญูู `_id` ูุฃูู ูุชููุน ObjectId ุตุญูุญ ุฃู ูุง ุดูุก

### 2๏ธโฃ ุฎุทุฃ ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู (Client Error)
```
Application error: a client-side exception has occurred
while loading ddds-peach.vercel.app
```

**ุงูุณุจุจ:**
- ูุดู ูู ูุนุงูุฌุฉ ุงูุงุณุชุซูุงุกุงุช ุนูุฏ ุฅูุดุงุก ุฃู ูุชุญ ุงููุญุงุฏุซุงุช
- ุนุฏู ูุฌูุฏ ูุนุงูุฌุฉ ููุฃุฎุทุงุก ูู ุญุงูุฉ ูุดู ุฅูุดุงุก ุงูุบุฑูุฉ

### 3๏ธโฃ ูุดุงูู ุฅุถุงููุฉ
- โ ุนุฏู ูุชุญ ุงููุญุงุฏุซุงุช ุงูููุฌูุฏุฉ ูุณุจูุงู ุจุดูู ุตุญูุญ
- โ ุนุฏู ุฅููุงููุฉ ุฅุฑุณุงู ุงูุฑุณุงุฆู ูู ุงููุญุงุฏุซุงุช ุงูุฌุฏูุฏุฉ
- โ ุนุฏู ุฅุนุงุฏุฉ ุชูุฌูู ุงููุณุชุฎุฏู ูููุญุงุฏุซุฉ ุจุนุฏ ุฅูุดุงุฆูุง

---

## โ ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### 1๏ธโฃ ุฅุตูุงุญ `LeftBar.tsx` (ุงููุงุฌูุฉ ุงูุฃูุงููุฉ)

#### โ ุงูุชุบููุฑ ุงูุฃุณุงุณู:
```typescript
// โ ูุจู ุงูุฅุตูุงุญ - ูุงู ูุฑุณู _id ูุงุฑุบ
const userRoom = {
  // ... other fields
  _id: "",  // โ ุงููุดููุฉ ููุง!
};
setter({ selectedRoom: userRoom });
roomsSocket?.emit("joining", doctor._id);

// โ ุจุนุฏ ุงูุฅุตูุงุญ - ููุดุฆ ุงูุบุฑูุฉ ุฃููุงู ุซู ููุชุญูุง
roomsSocket?.emit("createRoom", { 
  newRoomData: {
    name: userId + "-" + doctor._id,
    type: "private",
    participants: [userId, doctor._id], // โ IDs ููุท
    admins: [userId, doctor._id],
    // ... ุญููู ุฃุฎุฑู ุจุฏูู _id
  }
});

// ุงูุงูุชุธุงุฑ ูุญูู ุฅูุดุงุก ุงูุบุฑูุฉ
roomsSocket?.once("createRoom", (createdRoom) => {
  userRoom._id = createdRoom._id; // โ ุงุณุชุฎุฏุงู ID ุงูุตุญูุญ
  setter({ selectedRoom: userRoom });
  roomsSocket?.emit("joining", createdRoom._id);
});
```

#### โ ุฅุถุงูุฉ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
```typescript
// ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
roomsSocket?.once("createRoomError", (error) => {
  console.error('โ Failed to create room:', error);
  alert(`ูุดู ุฅูุดุงุก ุงููุญุงุฏุซุฉ: ${error.error || 'ุฎุทุฃ ุบูุฑ ูุนุฑูู'}`);
});
```

#### โ ุชุญุณูู ูุชุญ ุงูุบุฑู ุงูููุฌูุฏุฉ:
```typescript
if (existingRoom) {
  // โ ูุชุญ ุงูุบุฑูุฉ ูุจุงุดุฑุฉ ูุน ุชุญุฏูุซ ุงูุญุงูุฉ
  setter({ 
    isRoomDetailsShown: false, 
    selectedRoom: existingRoom 
  });
  roomsSocket?.emit("joining", existingRoom._id);
  return; // ุงูุฎุฑูุฌ ูู ุงูุฏุงูุฉ
}
```

---

### 2๏ธโฃ ุฅุตูุงุญ `server/index.js` (ุงูุฎุงุฏู)

#### โ ุฅุถุงูุฉ ุงูุชุญูู ูู ุงูุจูุงูุงุช:
```javascript
// โ ุงูุชุญูู ูู ุงูุญููู ุงููุทููุจุฉ
if (!newRoomData.name || !newRoomData.type) {
  console.error('โ Missing required fields');
  socket.emit('createRoomError', { 
    error: 'Missing required fields',
    details: 'Room name and type are required'
  });
  return;
}
```

#### โ ุชุญุณูู ุงุณุชุฎุฑุงุฌ ูุนุฑูุงุช ุงููุดุงุฑููู:
```javascript
// โ ุงุณุชุฎุฑุงุฌ IDs ูุจู ุงูุจุญุซ ุนู ุงูุบุฑูุฉ
let participantIDs = [];
if (Array.isArray(newRoomData.participants)) {
  participantIDs = newRoomData.participants
    .map((data) => {
      if (typeof data === 'string') return data;
      return data?._id || null;
    })
    .filter(Boolean);
  
  // โ ุงูุชุญูู ูู ูุฌูุฏ ูุนุฑูุงุช ุตุญูุญุฉ
  if (participantIDs.length === 0) {
    socket.emit('createRoomError', { 
      error: 'Invalid participants'
    });
    return;
  }
}
```

#### โ ูุนุงูุฌุฉ _id ุงููุงุฑุบ:
```javascript
// โ ุญุฐู _id ุฅุฐุง ูุงู ูุงุฑุบุงู
if (newRoomData._id === "" || newRoomData._id === null) {
  delete newRoomData._id;
}
```

#### โ ุชุญุณูู ูุนุงูุฌุฉ ุงูุบุฑู ุงูููุฌูุฏุฉ:
```javascript
if (isRoomExist) {
  console.log('โน๏ธ Room already exists:', isRoomExist._id);
  // โ ุฅุฑุณุงู ุงูุบุฑูุฉ ุงูููุฌูุฏุฉ ููุนููู
  socket.join(isRoomExist._id.toString());
  socket.emit('createRoom', isRoomExist);
}
```

#### โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุดุงููุฉ:
```javascript
catch (createRoomError) {
  console.error('โ Error in createRoom:', createRoomError);
  console.error('โ Stack:', createRoomError.stack);
  
  // โ ุฅุฑุณุงู ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ููุนููู
  socket.emit('createRoomError', {
    error: createRoomError.message,
    details: createRoomError.name,
    stack: process.env.NODE_ENV === 'development' ? createRoomError.stack : undefined
  });
}
```

---

### 3๏ธโฃ ุฅุถุงูุฉ ุตูุญุฉ ุฎุทุฃ ุนุงูุฉ `error.tsx`

```typescript
// โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุนูู ูุณุชูู ุงูุชุทุจูู
export default function Error({ error, reset }) {
  useEffect(() => {
    console.error('Application error:', error);
  }, [error]);

  return (
    <div className="error-container">
      <h2>ุญุฏุซ ุฎุทุฃ ูุง!</h2>
      <p>{error.message || 'ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน'}</p>
      <button onClick={() => reset()}>ุญุงูู ูุฑุฉ ุฃุฎุฑู</button>
    </div>
  );
}
```

---

## ๐ ุชุฏูู ุงูุนูู ุงูุฌุฏูุฏ

### ุณููุงุฑูู 1: ุฅูุดุงุก ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ
```
1. ุงููุณุชุฎุฏู ูููุฑ ุนูู ุทุจูุจ ูู ุงููุงุฆูุฉ
   โ
2. ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ูุญุงุฏุซุฉ ุณุงุจูุฉ
   โ
3. ุฅุฑุณุงู ุทูุจ createRoom ูุน ุจูุงูุงุช ุตุญูุญุฉ (ุจุฏูู _id ูุงุฑุบ)
   โ
4. ุงูุฎุงุฏู ูุชุญูู ูู ุงูุจูุงูุงุช
   โ
5. ุฅูุดุงุก ุงูุบุฑูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   โ
6. ุฅุฑุณุงู ุงูุบุฑูุฉ ุงูููุดุฃุฉ ููุนููู
   โ
7. ุงูุนููู ููุชุญ ุงูุบุฑูุฉ ุจูุนุฑููุง ุงูุตุญูุญ
   โ
8. โ ูููู ุงูุขู ุฅุฑุณุงู ุงูุฑุณุงุฆู ุจูุฌุงุญ!
```

### ุณููุงุฑูู 2: ูุชุญ ูุญุงุฏุซุฉ ููุฌูุฏุฉ
```
1. ุงููุณุชุฎุฏู ูููุฑ ุนูู ุทุจูุจ ูู ุงููุงุฆูุฉ
   โ
2. ุงูุจุญุซ ุนู ูุญุงุฏุซุฉ ููุฌูุฏุฉ
   โ
3. ุฅุฐุง ููุฌุฏุช: ูุชุญูุง ูุจุงุดุฑุฉ
   โ
4. โ ูููู ุงููุชุงุจุนุฉ ูู ุงููุญุงุฏุซุฉ!
```

---

## ๐งช ุงูุงุฎุชุจุงุฑุงุช ุงููุทููุจุฉ

### โ ูุง ูุฌุจ ุงุฎุชุจุงุฑู:

1. **ุฅูุดุงุก ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ:**
   - ุงููุฑ ุนูู ุทุจูุจ ููุณ ูุฏูู ูุญุงุฏุซุฉ ูุนู
   - ุชุญูู ูู ุฅูุดุงุก ุงูุบุฑูุฉ ุจูุฌุงุญ
   - ุชุญูู ูู ุฅููุงููุฉ ุฅุฑุณุงู ุฑุณุงุฆู

2. **ูุชุญ ูุญุงุฏุซุฉ ููุฌูุฏุฉ:**
   - ุงููุฑ ุนูู ุทุจูุจ ูุฏูู ูุญุงุฏุซุฉ ุณุงุจูุฉ ูุนู
   - ุชุญูู ูู ูุชุญ ุงููุญุงุฏุซุฉ ูุจุงุดุฑุฉ
   - ุชุญูู ูู ุนุฑุถ ุงูุฑุณุงุฆู ุงููุฏููุฉ

3. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:**
   - ุญุงูู ุฅูุดุงุก ูุญุงุฏุซุฉ ุจุฏูู ุงุชุตุงู
   - ุชุญูู ูู ุธููุฑ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ

4. **ุงูุฎุงุฏู:**
   - ุฑุงูุจ ุณุฌูุงุช Railway
   - ุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุฃุฎุทุงุก MongoDB
   - ุชุญูู ูู ุฅูุดุงุก ุงูุบุฑู ุจูุฌุงุญ

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

| ุงูููู | ุงูุชุบููุฑุงุช | ุงููุชูุฌุฉ |
|------|----------|---------|
| `LeftBar.tsx` | ุฅุตูุงุญ ููุทู ุฅูุดุงุก ุงูุบุฑู | โ ูุง ูุฒูุฏ ูู _id ูุงุฑุบ |
| `server/index.js` | ุฅุถุงูุฉ ุงูุชุญูู ููุนุงูุฌุฉ ุงูุฃุฎุทุงุก | โ ุฃุฎุทุงุก ูุงุถุญุฉ ููููููุฉ |
| `error.tsx` | ุตูุญุฉ ุฎุทุฃ ุนุงูุฉ | โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู |

---

## ๐ฏ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### โ ูุง ุชู ุฅุตูุงุญู:
- โ ูุง ูุฒูุฏ ูู ุฎุทุฃ `Cast to ObjectId failed`
- โ ูุง ูุฒูุฏ ูู `client-side exception`
- โ ุฅูุดุงุก ูุญุงุฏุซุงุช ุฌุฏูุฏุฉ ูุนูู ุจุดูู ุตุญูุญ
- โ ูุชุญ ูุญุงุฏุซุงุช ููุฌูุฏุฉ ูุนูู ุจุดูู ุตุญูุญ
- โ ุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุฑุณุงุฆู ูุนูู ุจุดูู ุทุจูุนู

### ๐ ูุง ูุฌุจ ูุฑุงูุจุชู:
- ๐ ุณุฌูุงุช ุงูุฎุงุฏู (Railway) ููุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุฃุฎุทุงุก ุฌุฏูุฏุฉ
- ๐ฅ๏ธ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Vercel) ููุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุดุงุดุฉ ุฎุทุฃ ุณูุฏุงุก
- ๐ฌ ุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุฑุณุงุฆู ุจุดูู ููุฑู

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ูููุณุชุฎุฏู

1. **ุงูุชุธุฑ ุฅุนุงุฏุฉ ูุดุฑ ุงููุดุฑูุน:**
   - Vercel ุณูุนูุฏ ุงููุดุฑ ุชููุงุฆูุงู
   - Railway ุณูุนูุฏ ุจูุงุก ุงูุฎุงุฏู ุชููุงุฆูุงู

2. **ุงุฎุชุจุฑ ุงููุญุงุฏุซุงุช:**
   - ุฌุฑุจ ุฅูุดุงุก ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ ูุน ุทุจูุจ
   - ุฌุฑุจ ูุชุญ ูุญุงุฏุซุฉ ููุฌูุฏุฉ
   - ุฌุฑุจ ุฅุฑุณุงู ุฑุณุงุฆู

3. **ุฑุงูุจ ุงูุฃุฎุทุงุก:**
   - ุฅุฐุง ุธูุฑุช ุฃู ูุดุงููุ ุฑุงุฌุน ุณุฌูุงุช Railway
   - ุฅุฐุง ุธูุฑุช ุดุงุดุฉ ุฎุทุฃุ ุฑุงุฌุน console ูู ุงููุชุตูุญ

---

## ๐ ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู ุจุนุฏ ูุฐุง ุงูุฅุตูุงุญ:

1. **ุชุญูู ูู ุณุฌูุงุช Railway:**
   ```
   https://railway.com/project/YOUR_PROJECT_ID/service/YOUR_SERVICE_ID/logs
   ```

2. **ุชุญูู ูู console ุงููุชุตูุญ:**
   - ุงูุชุญ Developer Tools (F12)
   - ุงุฐูุจ ุฅูู ุชุจููุจ Console
   - ุงุจุญุซ ุนู ุฃุฎุทุงุก ุจุงูููู ุงูุฃุญูุฑ

3. **ุดุงุฑู ุงูุชูุงุตูู:**
   - ุฃุฑุณู ููุทุฉ ุดุงุดุฉ ููุฎุทุฃ
   - ุฃุฑุณู ุณุฌูุงุช ุงูุฎุงุฏู ุฅู ุฃููู

---

**ุชู ุงูุฅุตูุงุญ ุจูุฌุงุญ! โ**

ุงูุชุงุฑูุฎ: 2025-11-12
ุงูุฅุตุฏุงุฑ: 1.0.0
ุงูุญุงูุฉ: ุชู ุงููุดุฑ ุนูู main branch
